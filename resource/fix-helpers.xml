<?xml version="1.0"?>
<!DOCTYPE project>
<project name="com.here.validate.svrl">

	<macrodef name="init">
		<attribute name="file"/>
		<sequential>
			<taskdef name="xmltask" classname="com.oopsconsultancy.xmltask.ant.XmlTask" classpathref="dost.class.path"/>

			<dirname property="com.here.fix-dita.dir" file="${ant.file.com.here.fix-dita}"></dirname>

			<xmlcatalog id="fake.dita.catalog">
				<dtd publicId="-//OASIS//DTD DITA Topic//EN" location="${com.here.fix-dita.dir}/dtd/fake.dtd"/>
				<dtd publicId="-//OASIS//DTD DITA Map//EN" location="${com.here.fix-dita.dir}/dtd/fake.dtd"/>
				<dtd publicId="-//OASIS//DTD DITA DITAVAL//EN" location="${com.here.fix-dita.dir}/dtd/fake.dtd"/>
				<dtd publicId="-//OASIS//DTD DITA Concept//EN" location="${com.here.fix-dita.dir}/dtd/fake.dtd"/>
				<dtd publicId="-//OASIS//DTD DITA Task//EN" location="${com.here.fix-dita.dir}/dtd/fake.dtd"/>
			</xmlcatalog>
		</sequential>
	</macrodef>

	<!-- To lower case -->
	<scriptdef language="javascript" name="lower-case">
		<attribute name="string" />
		<attribute name="to" />
		project.setProperty(attributes.get("to"),attributes.get("string").toLowerCase());
	</scriptdef>


	<!--
		Macro to ensure specified entities are encoded in the text. This reverts the tendency of XMLTask
		to remove them

		@param  file -   The location of the topic file to update
		@param  name -   The name of the file
		@param  token -  The string to replace
		@param  value -  The value to use to replace the string
		@param	message - The message to display on screen
	-->
    <macrodef name="replace-entity">
		<attribute name="file"/>
		<attribute name="name"/>
		<attribute name="token"/>
		<attribute name="value"/>
		<attribute name="message"/>
		<sequential>
			<if>
        		<resourcecontains resource="@{file}" substring="@{token}"/>
    			<then>
    				<replace file="@{file}">
						<replacetoken>@{token}</replacetoken>
						<replacevalue>@{value}</replacevalue>
					</replace>
					<echo-validation-fix task="fix-text" id="incorrect-punctuation" name="@{name}"
						 message="@{message}"/>
				</then>
			</if>
		</sequential>
	</macrodef>

	<!--
		Macro to ensure specified entities are encoded in the text. This reverts the tendency of XMLTask
		to remove them

		@param  file - The location of the topic file to update
	-->
	<macrodef name="reinsert-entities">
		<attribute name="file"/>
		<attribute name="name"/>
		<sequential>
			<!-- non-breaking space -->
			<replace-entity name="@{name}" file="@{file}" token="&amp;nbsp;" value="&amp;#xa0;"
				message="&amp;nbsp; replaced with entity &amp;#xa0;"/>
			<!-- m-dash -->
			<replace-entity name="@{name}" file="@{file}" token="—" value="&amp;#x2014;"
				message="Replaced long n-dash with entity &amp;#x2014;"/>
			<!-- n-dash -->
			<replace-entity name="@{name}" file="@{file}" token="–" value="&amp;#x2013;"
				 message="Replaced long m-dash with entity &amp;#x2013;"/>
			<!--open curly double quote -->
			<replace-entity name="@{name}" file="@{file}" token="“" value="&quot;"
				  message="Replaced quotes with straight quotes"/>
			<!-- close curly double quote -->
			<replace-entity name="@{name}" file="@{file}" token="”" value="&quot;"
				  message="Replaced quotes with straight quotes"/>
			<!--open curly single quote -->
			<replace-entity name="@{name}" file="@{file}" token="‘" value="'"
				 message="Replaced smart single quote with single quote"/>
			<!-- close curly single quote -->
			<replace-entity name="@{name}" file="@{file}" token="’" value="'"
				 message="Replaced smart single quote with single quote"/>

		</sequential>
	</macrodef>
</project>